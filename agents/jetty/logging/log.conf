input {
  file {
	type => "request"
	path => "/DATA/ads_slave/deployments/8081/hp/mqm/server/logs/*.log"
	start_position => "beginning"
  }
  file {
	type => "mqm_log"
	path => "/DATA/ads_slave/deployments/8081/hp/mqm/log/qc/*.html"
	start_position => "beginning"
  }
  file {
	type => "SA_log"
	path => "/DATA/ads_slave/deployments/8081/hp/mqm/log/sa/*.html"
	start_position => "beginning"
  }
  file {
	type => "jetty_error_log"
	path => "/DATA/ads_slave/deployments/8081/hp/mqm/log/*.stderrout.log"
	start_position => "beginning"
	codec => multiline {
		pattern => "^%{YEAR}"
		negate => "true"
		what => "previous"
	}
  }
}

filter {
  if [type] == "mqm_log" or [type] == "sa_log" {
	if [message] =~ /<tr bgcolor=".*"><td>.*/ {
		grok {
        		match => { "message" => "<tr bgcolor=.*><td>%{MQMTIME:db_date}</td><td>%{MQMTIME:alm_date}</td><td>%{DATA:thread}</td><td>%{DATA:req_type}</td><td>%{DATA:username}</td><td>%{IP:ip}</td><td>%{DATA:level}</td><td>%{DATA:method}</td><td>%{DATA:err_message}</td></tr>" }
		}
		mutate {
			gsub => ['db_date', "<br>", " ", 'alm_date', "<br>", " "]
		}
	} else {
		drop {}
	}
  }
  if [type] == "jetty_error_log" {
# this of course should be changed to regexp
 	if ("2015-" in [message]) {
		grok {
        		match => { "message" => [
						"%{JETTYTIME1:date}:%{LOGLEVEL:level}:%{NOTSPACE:process}:%{GREEDYDATA:error}",
						"%{JETTYTIME2:date} %{WORD:process} %{WORD:level} %{NOTSPACE:class} %{GREEDYDATA:error}"				
				]
			}
		}
	} else if [message] =~ /([0-9]+:[0-9]+:[0-9]+) .*/ {
		mutate {
			gsub => ['message', "\n", " ", 'message', "\t", ""]
		}
		grok {
		       	match => { "message" => "%{TIME:date} %{LOGLEVEL:level} %{GREEDYDATA:error}" }
		}
	} else {
	}
  }
}

output { stdout { codec => rubydebug }
  if [type] == "request" {
	http {
		http_method => "post"
		url => "http://myd-vm00366.hpswlabs.adapps.hp.com:8080/data"
		mapping =>  ["type", "request", "host" ,"%{host}", "timestamp", "%{@timestamp}", "message", "%{message}"]
	}
  }
  if [type] == "mqm_log" or [type] == "sa_log" {
	http {
		format => "message"
		content_type => "application/json"
		http_method => "post"
		url => "http://myd-vm00366.hpswlabs.adapps.hp.com:8080/data"
		message=> '{
			"type": "%{type}",
			"db_date":"%{db_date}", 
			"alm_date":"%{alm_date}", 
			"thread": "%{thread}", 
			"req_type": "%{req_type}", 
			"username": "%{username}", 
			"ip": "%{ip}",
			"level": "%{level}",
			"method": "%{method}",
			"message": "%{err_message}"
		
		}'
	}
  }
  if [type] == "jetty_error_log" {
	http {
		format => "message"
		content_type => "application/json"
		http_method => "post"
		url => "http://myd-vm00366.hpswlabs.adapps.hp.com:8080/data"
		message=> '{
			"type": "%{type}",
			"date":"%{date}", 
			"level":"%{level}",
			"message": "%{error}"
		
		}'
	}
  }
}